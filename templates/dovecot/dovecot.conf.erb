# Automatically generated by https://github.com/mneumann/mailconfgen
<% defines_file 'dovecot/dovecot.conf' %>
<% requires_version '0.0.1' %>

protocols = imap lmtp

<% if confval! 'services.dovecot.logging' %>
log_path = /var/log/dovecot.log
debug_log_path = /var/log/dovecot-debug.log
info_log_path = /var/log/dovecot-info.log
<% else %>
# We want no logging!
log_path = /dev/null
debug_log_path = /dev/null
info_log_path = /dev/null
<% end %>

ssl_min_protocol = TLSv1.2
ssl_prefer_server_ciphers = yes

# A comma separated list of IPs or hosts where to listen in for connections.
# "*" listens in all IPv4 interfaces, "::" listens in all IPv6 interfaces.
# If you want to specify non-default ports or anything more complex,
# edit conf.d/master.conf.
listen = *, ::

service imap-login {
  inet_listener imap {
    # this disables the imap login
    port = 0 # 143
  }
  inet_listener imaps {
    port = 993
    ssl = yes
  }
}

service lmtp {
  # starts by default a unix domain socket listener on /var/run/dovecot/lmtp
  unix_listener lmtp {
    user  = vmail
    group = vmail
  }
}

auth_mechanisms = plain

# Base directory where to store runtime data.
base_dir = /var/run/dovecot/

# SSL
ssl = required
ssl_cert = <<%= confval! 'server.pki.cert' %>
ssl_key = <<%= confval! 'server.pki.key' %>

mail_location = maildir:~/Maildir

passdb {
  driver = passwd-file
  args = username_format=%u <%= absolute_file_path("dovecot/passwd") %>
}

userdb {
  driver = passwd-file
  args = username_format=%u <%= absolute_file_path("dovecot/passwd") %>
}

namespace inbox {
  inbox = yes

  mailbox Drafts {
    auto = subscribe
  }

  mailbox Sent {
    auto = subscribe
  }

  mailbox Trash {
    auto = subscribe
  }
}
